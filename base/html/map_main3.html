<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>지도</title>
    <script src="/base/js/lib/jquery-3.5.1.min.js"></script>
    <script src="/base/js/lib/jquery-ui.min.js"></script>
    <script src="/base/js/lib/semantic.min.js"></script>
    <script src="/base/js/lib/jquery.modal.min.js"></script>
    <script src="http://map.ngii.go.kr/emap/js/map/OpenLayers-6.4.3.js"></script>
    <script src="http://map.ngii.go.kr/nps/common/lib/proj4js/proj4.js"></script>
    <script src="http://map.ngii.go.kr/openapi/wmts_ngiiMap_v6.4.3.js?apikey=04trYP9_xwLAfALjwZ-B8g"></script>
    <!-- includeHTML.js : 퍼블리싱 확인용 include -->
    <script src="/base/js/common/includeHTML.js"></script>
    <script src="/base/js/common/ui.js"></script>
    <link rel="stylesheet" href="http://map.ngii.go.kr/emap/css/map/OpenLayers-6.4.3.css" />
    <link rel="stylesheet" href="/base/css/common.css" />
  </head>
  <body>
    <div class="wrapper">
      <!-- GNB -->
      <nav class="gnb" include-html="/base/html/common/gnb.html"></nav>

      <main class="ly-container">
        <div id="map1" class="ly-map">
          <!-- 돌발 검지 시스템 아이콘 -->
          <div class="unexp-bind" style="left: 800px; top: 382px">
            <!-- 
              is-turn클래스(기본) 추가시: 회전
              is-return클래스 추가시: 돌발
            -->
            <div class="turn-return-btn-wrap is-turn">
              <button type="button" class="btn-turn"><span class="screen-out">회전</span></button>
              <button type="button" class="btn-return"><span class="screen-out">돌발</span></button>
            </div>
            <i class="ico-unexp js-no-dimed-popup-call" data-target="unexp-popup">
              <span class="screen-out">돌발 검지 시스템 버튼</span>
            </i>
          </div>

          <!-- 돌발검지 시스템 및 돌발 팝업 -->
          <div id="unexp-popup" class="map-popup">
            <div class="inner">
              <div class="bind spot">
                <header class="map-popup-header">공릉역 사거리</header>
                <div class="map-popup-content">
                  <div class="line-box-container">
                    <div class="box">
                      <em class="tit">카메라 상태</em>
                      <span class="txt-disorder">카메라 이상(192.168.172.130)</span>
                      <!-- <span class="txt-normality">정상</span> -->
                    </div>
                    <!-- 230829 box-column-bind Div 추가 -->
                    <div class="box-column-bind">
                      <div class="box-column">
                        <div class="box">
                          <em class="tit">돌발 발생 건 수</em>
                        </div>
                        <div class="box">
                          <table class="state-tbl type2">
                            <colgroup>
                              <col style="width: 60%" />
                              <col style="width: 40%" />
                            </colgroup>
                            <tbody>
                              <tr>
                                <th>정지</th>
                                <td>12건</td>
                              </tr>
                              <tr>
                                <th>역주행</th>
                                <td>122건</td>
                              </tr>
                              <tr>
                                <th>회전식 신호철주 미복귀</th>
                                <td>11건</td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                      </div>
                      <!-- //box-column -->
                    </div>
                    <!-- //box-column-bind -->
                  </div>
                  <!-- //line-box-container -->
                </div>
                <!-- //map-popup-content -->
                <div class="map-popup-btn-group">
                  <a href="#" class="ui primary basic button rounded">돌발 상세</a>
                  <a href="#" class="ui primary basic button rounded">지점 관리</a>
                </div>
                <!-- //map-popup-btn-group -->
              </div>
              <!-- //bind -->
              <div class="bind">
                <header class="map-popup-header">돌발 발생</header>
                <div class="map-popup-content">
                  <div class="line-box-container">
                    <div class="box is-label">
                      <em class="tit">유형</em>
                      <span class="box-label c-pink">역주행</span>
                    </div>
                    <div class="box">
                      <em class="tit">일시</em>
                      <span class="txt">2021-08-06 16:30:12</span>
                    </div>
                    <div class="box">
                      <em class="tit">위치</em>
                      <span class="txt">공릉역 사거리, 태릉입구역 방면</span>
                    </div>
                    <div class="box">
                      <em class="tit">차로</em>
                      <span class="txt">3차로</span>
                    </div>
                  </div>
                </div>
                <!-- //map-popup-content -->
                <div class="map-popup-btn-group">
                  <a href="#" class="ui primary basic button rounded">돌발 상세 정보</a>
                </div>
                <!-- //map-popup-btn-group -->
              </div>
              <!-- //bind -->
            </div>
            <!-- //inner -->
          </div>
          <!-- //map-popup -->

          <!-- vms 아이콘 -->
          <i class="ico-vms js-no-dimed-popup-call" data-target="vms-popup" style="left: 650px; top: 750px">
            <span class="screen-out">vms 버튼</span>
          </i>

          <!-- vms 팝업 -->
          <div id="vms-popup" class="map-popup mw311">
            <header class="map-popup-header">VMS 명칭</header>
            <div class="map-popup-content">
              <div class="line-box-container">
                <div class="box">
                  <em class="tit">VMS 상태</em>
                  <span class="txt-disorder">VMS 이상(192.168.1.12)</span>
                  <!-- <span class="txt-normality">정상</span> -->
                </div>
                <div class="box-column">
                  <div class="box">
                    <em class="tit">표출 상태</em>
                  </div>
                  <div class="box">
                    <div class="vms-status-display">
                      <p><em class="emp1">전방</em> 비봉 IC <i>▶</i> 군포 IC</p>
                      <p>서해안선 <em class="emp2">서행</em></p>
                      <p>국도 <em class="emp1">소통원활</em></p>
                    </div>
                    <!-- //vms-status-display -->
                  </div>
                </div>
                <!-- //box-column -->
              </div>
              <!-- //line-box-container -->
            </div>
            <!-- //map-popup-content -->
            <div class="map-popup-btn-group">
              <a href="#" class="ui primary basic button rounded">시설물 관리</a>
              <a href="#" class="ui primary basic button rounded">VMS 수동 제어</a>
            </div>
            <!-- //map-popup-btn-group -->
          </div>
          <!-- //map-popup -->

          <!-- 교차로 아이콘 -->
          <div class="los-display lv-a" style="left: 400px; top: 382px">
            <i class="ico-cr js-no-dimed-popup-call" data-target="crossing-popup"><span class="screen-out">교차로</span></i>

            <i class="traffic-display top c-red" style="transform: rotate(0deg)"></i>
            <i class="traffic-display bottom c-orange" style="transform: rotate(0deg)"></i>
            <i class="traffic-display left" style="transform: rotate(0deg)"></i>
            <i class="traffic-display right" style="transform: rotate(0deg)"></i>
          </div>

          <!-- 230815 : 돌발 아이콘 -->
          <i class="ico-triangle-exclamation c-red" style="left: 453px; top: 378px"><span class="screen-out">돌발 발생</span></i>

          <!-- 230815 : 교차로 클릭시 나오는 팝업 -->
          <div id="crossing-popup" class="map-popup">
            <div class="inner">
              <div class="bind">
                <header class="map-popup-header">공릉역 사거리</header>
                <div class="map-popup-content">
                  <div class="line-box-container">
                    <div class="box-row">
                      <div class="box is-label">
                        <em class="tit">LOS 등급</em>
                        <span class="box-label c-violet">FFF 등급</span>
                      </div>
                      <div class="box">
                        <em class="tit">차량 통행량</em>
                        <span class="txt">3,100대</span>
                      </div>
                    </div>
                    <!-- //box-row -->
                    <div class="box">
                      <em class="tit">카메라 상태</em>
                      <span class="txt-normality">정상</span>
                      <!-- <span class="txt-disorder">카메라 이상(192.168.172.130)</span> -->
                    </div>
                    <!-- 230829 box-column-bind Div 추가 -->
                    <div class="box-column-bind">
                      <div class="box-column">
                        <div class="box">
                          <em class="tit">함체 상태 (192.168.172.131)</em>
                        </div>
                        <div class="box">
                          <table class="state-tbl">
                            <colgroup>
                              <col style="width: 15%" />
                              <col />
                              <col style="width: 15%" />
                              <col />
                            </colgroup>
                            <tbody>
                              <tr>
                                <th>팬</th>
                                <td>
                                  <div class="bind">
                                    <label class="radio-txt2 rounded">
                                      <input type="radio" name="state1" />
                                      <span>ON</span>
                                    </label>
                                    <label class="radio-txt2 rounded">
                                      <input type="radio" name="state1" />
                                      <span>OFF</span>
                                    </label>
                                  </div>
                                </td>
                                <th>히터</th>
                                <td>
                                  <div class="bind">
                                    <label class="radio-txt2 rounded">
                                      <input type="radio" name="state2" />
                                      <span>ON</span>
                                    </label>
                                    <label class="radio-txt2 rounded">
                                      <input type="radio" name="state2" />
                                      <span>OFF</span>
                                    </label>
                                  </div>
                                </td>
                              </tr>
                              <tr>
                                <th>앞문</th>
                                <td>
                                  <div class="bind">
                                    <label class="radio-txt2 rounded">
                                      <input type="radio" name="state3" />
                                      <span>열림</span>
                                    </label>
                                    <label class="radio-txt2 rounded">
                                      <input type="radio" name="state3" />
                                      <span>닫힘</span>
                                    </label>
                                  </div>
                                </td>
                                <th>뒷문</th>
                                <td>
                                  <div class="bind">
                                    <label class="radio-txt2 rounded">
                                      <input type="radio" name="state4" />
                                      <span>열림</span>
                                    </label>
                                    <label class="radio-txt2 rounded">
                                      <input type="radio" name="state4" />
                                      <span>닫힘</span>
                                    </label>
                                  </div>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                      </div>
                      <!-- //box-column -->
                      <div class="box-column">
                        <div class="box">
                          <em class="tit">함체 상태 (192.168.172.131)</em>
                        </div>
                        <div class="box">
                          <table class="state-tbl">
                            <colgroup>
                              <col style="width: 15%" />
                              <col />
                              <col style="width: 15%" />
                              <col />
                            </colgroup>
                            <tbody>
                              <tr>
                                <th>팬</th>
                                <td>
                                  <div class="bind">
                                    <label class="radio-txt2 rounded">
                                      <input type="radio" name="state1-2" />
                                      <span>ON</span>
                                    </label>
                                    <label class="radio-txt2 rounded">
                                      <input type="radio" name="state1-2" />
                                      <span>OFF</span>
                                    </label>
                                  </div>
                                </td>
                                <th>히터</th>
                                <td>
                                  <div class="bind">
                                    <label class="radio-txt2 rounded">
                                      <input type="radio" name="state2-2" />
                                      <span>ON</span>
                                    </label>
                                    <label class="radio-txt2 rounded">
                                      <input type="radio" name="state2-2" />
                                      <span>OFF</span>
                                    </label>
                                  </div>
                                </td>
                              </tr>
                              <tr>
                                <th>앞문</th>
                                <td>
                                  <div class="bind">
                                    <label class="radio-txt2 rounded">
                                      <input type="radio" name="state3-2" />
                                      <span>열림</span>
                                    </label>
                                    <label class="radio-txt2 rounded">
                                      <input type="radio" name="state3-2" />
                                      <span>닫힘</span>
                                    </label>
                                  </div>
                                </td>
                                <th>뒷문</th>
                                <td>
                                  <div class="bind">
                                    <label class="radio-txt2 rounded">
                                      <input type="radio" name="state4-2" />
                                      <span>열림</span>
                                    </label>
                                    <label class="radio-txt2 rounded">
                                      <input type="radio" name="state4-2" />
                                      <span>닫힘</span>
                                    </label>
                                  </div>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                      </div>
                      <!-- //box-column -->
                      <div class="box-column">
                        <div class="box">
                          <em class="tit">함체 상태 (192.168.172.131)</em>
                        </div>
                        <div class="box">
                          <table class="state-tbl">
                            <colgroup>
                              <col style="width: 15%" />
                              <col />
                              <col style="width: 15%" />
                              <col />
                            </colgroup>
                            <tbody>
                              <tr>
                                <th>팬</th>
                                <td>
                                  <div class="bind">
                                    <label class="radio-txt2 rounded">
                                      <input type="radio" name="state1-2" />
                                      <span>ON</span>
                                    </label>
                                    <label class="radio-txt2 rounded">
                                      <input type="radio" name="state1-2" />
                                      <span>OFF</span>
                                    </label>
                                  </div>
                                </td>
                                <th>히터</th>
                                <td>
                                  <div class="bind">
                                    <label class="radio-txt2 rounded">
                                      <input type="radio" name="state2-2" />
                                      <span>ON</span>
                                    </label>
                                    <label class="radio-txt2 rounded">
                                      <input type="radio" name="state2-2" />
                                      <span>OFF</span>
                                    </label>
                                  </div>
                                </td>
                              </tr>
                              <tr>
                                <th>앞문</th>
                                <td>
                                  <div class="bind">
                                    <label class="radio-txt2 rounded">
                                      <input type="radio" name="state3-2" />
                                      <span>열림</span>
                                    </label>
                                    <label class="radio-txt2 rounded">
                                      <input type="radio" name="state3-2" />
                                      <span>닫힘</span>
                                    </label>
                                  </div>
                                </td>
                                <th>뒷문</th>
                                <td>
                                  <div class="bind">
                                    <label class="radio-txt2 rounded">
                                      <input type="radio" name="state4-2" />
                                      <span>열림</span>
                                    </label>
                                    <label class="radio-txt2 rounded">
                                      <input type="radio" name="state4-2" />
                                      <span>닫힘</span>
                                    </label>
                                  </div>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                      </div>
                      <!-- //box-column -->
                    </div>
                    <!-- //box-column-bind -->
                  </div>
                  <!-- //line-box-container -->
                </div>
                <!-- //map-popup-content -->
                <div class="map-popup-btn-group">
                  <a href="#" class="ui primary basic button rounded">교차로 상세</a>
                  <a href="#" class="ui primary basic button rounded">지점 관리</a>
                  <a href="#" class="ui primary basic button rounded">도로 관리</a>
                </div>
                <!-- //map-popup-btn-group -->
              </div>
              <!-- //bind -->
              <div class="bind">
                <header class="map-popup-header">돌발 발생</header>
                <div class="map-popup-content">
                  <div class="line-box-container">
                    <div class="box is-label">
                      <em class="tit">유형</em>
                      <span class="box-label c-pink">역주행</span>
                    </div>
                    <div class="box">
                      <em class="tit">일시</em>
                      <span class="txt">2021-08-06 16:30:12</span>
                    </div>
                    <div class="box">
                      <em class="tit">위치</em>
                      <span class="txt">공릉역 사거리, 태릉입구역 방면</span>
                    </div>
                    <div class="box">
                      <em class="tit">차로</em>
                      <span class="txt">3차로</span>
                    </div>
                  </div>
                </div>
                <!-- //map-popup-content -->
                <div class="map-popup-btn-group">
                  <a href="#" class="ui primary basic button rounded">돌발 상세 정보</a>
                </div>
                <!-- //map-popup-btn-group -->
              </div>
              <!-- //bind -->
            </div>
            <!-- //inner -->
          </div>
          <!-- //map-popup -->

          <!-- 230902 : 돌발/장애 탭 팝업 -->
          <!-- 231028 : active클래스 추가시 노출 / 제거시 숨김 -->
          <div class="sudden-disorder-popup" include-html="/base/html/common/sudden_disorder_popup.html"></div>
          <!-- //sudden-disorder-popup -->

          <button type="button" class="btn-branch-list">
            <span class="screen-out">지점 목록 버튼</span>
          </button>
          <div class="branch-list-popup">
            <div class="branch-list-header">
              <em>지점 목록</em>
              <button type="button" class="btn-close"><span class="screen-out">지점 목록 닫기</span></button>
            </div>
            <!-- //branch-list-header -->
            <div class="branch-list-search">
              <div class="selectbox-wrap xs">
                <select>
                  <option value="">전체</option>
                  <option value="">횡단보도</option>
                  <option value="">교차로</option>
                </select>
              </div>
              <!-- //selectbox-wrap -->
              <div class="ui input rounded xs">
                <input type="text" placeholder="검색어 입력" />
                <button type="button" class="btn-del"><span class="screen-out">삭제</span></button>
              </div>
              <!-- //input -->
            </div>
            <!-- //branch-list-search -->
            <ul class="branch-list-body">
              <li>
                <i class="ico-c"></i>
                <em class="txt">오일뱅크쌍용대로지점앞</em>
                <span class="bind">
                  <button type="button" class="btn-branch1"><span class="screen-out">버튼</span></button>
                  <button type="button" class="btn-branch2"><span class="screen-out">버튼</span></button>
                </span>
              </li>
              <li>
                <i class="ico-h"></i>
                <em class="txt">오일뱅크쌍용대로지점앞쌍용대로지점앞</em>
                <span class="bind">
                  <button type="button" class="btn-branch1"><span class="screen-out">버튼</span></button>
                  <button type="button" class="btn-branch2"><span class="screen-out">버튼</span></button>
                </span>
              </li>
              <li>
                <i class="ico-h"></i>
                <em class="txt">오일뱅크쌍용대로지점앞쌍용대로지점앞</em>
                <span class="bind">
                  <button type="button" class="btn-branch1"><span class="screen-out">버튼</span></button>
                  <button type="button" class="btn-branch2"><span class="screen-out">버튼</span></button>
                </span>
              </li>
            </ul>
            <!-- //branch-list-body -->
          </div>
          <!-- //branch-list-popup -->
        </div>
        <!-- //ly-map -->
      </main>
      <!-- //ly-container -->

      <footer class="ly-copyright" include-html="/base/html/common/footer.html"></footer>
    </div>
    <!-- //wrapper -->

    <script>
      // map init
      window.onload = function () {
        var map1 = new ngii_wmts.map('map1', { zoom: 6 });
      };

      // 230815 팝업 호출 함수
      function noDimedPopup() {
        $('.js-no-dimed-popup-call').on('click', function () {
          var $this = $(this);
          var $top = $this.offset().top;
          var $left = $this.offset().left;
          var $target = $this.data('target');
          var $popup = $('#' + $target);
          var $popupTop = $popup.outerHeight(true);
          var $popupLeft = $popup.outerWidth(true) / 2;
          if ($popup.css('display') !== 'block') {
            $popup
              .css({
                top: $top - $popupTop - 20,
                left: $left - $popupLeft - 38,
              })
              .fadeIn(200);
          }

          if ($target === 'unexp-popup') {
            $popup
              .css({
                top: $top - $popupTop - 60,
                left: $left - $popupLeft - 38,
              })
              .fadeIn(200);
          }

          $this.addClass('active'); // 230927: 교차로 아이콘 클릭시 교차로 아이콘 변경
        });
      }
      noDimedPopup();

      /* 230902 : 아래 js는 퍼블리싱 확인용입니다. 참고해서 개발화면에 반영 부탁드립니다. */
      // 돌발/장애 탭 메뉴
      setTimeout(function () {
        $('.sudden-disorder-popup .menu .item').tab();
      }, 200);

      /* 231028 gnb알림 버튼 클릭 이벤트 : 아래 js는 퍼블리싱 확인용입니다. 참고해서 개발화면에 반영 부탁드립니다. */
      $(document).on('click', '.btn-bell', function () {
        $('.sudden-disorder-popup').addClass('active');
        $('.gnb .aside .btn-m').removeClass('active');
        $('.gnb .aside .pop-user-info').hide();
      });

      // 스냅샷 드래그 이벤트 기능
      $('.sudden-snapshot-popup').draggable({
        handle: '.sudden-snapshot-header', // 231012: 핸들 옵션 추가
        containment: '.ly-map',
        start: function () {
          $(this).css('transform', 'none');
        },
      });

      // 231212 지점 목록 버튼 클릭 이벤트
      $(document).on('click', '.btn-branch-list', function () {
        $('.branch-list-popup').show(70);
      });
      $(document).on('click', '.branch-list-popup .btn-close', function () {
        $('.branch-list-popup').hide(70);
      });

      // 231204 지점 목록 검색창 활성화 이벤트 및 삭제 버튼 클릭시 생기는 side effect처리
      $('.branch-list-search .ui.input .btn-del').on('mousedown', function () {
        const $parent = $(this).parent();
        // .btn-del을 클릭한 경우에는 active 클래스 유지하고 clicked 클래스 추가
        $parent.addClass('active');
        $(this).addClass('clicked');
      });

      // .btn-del이 포커스를 잃으면 clicked 클래스를 제거하고 .ui.input input에 blur 이벤트 발생
      $('.branch-list-search .ui.input .btn-del').on('focusout', function () {
        $(this).removeClass('clicked');
        const $input = $(this).parent().find('input');

        // .btn-del 클릭 후 input에 focus가 되면 active 클래스 유지
        if ($input.is(':focus')) {
          $(this).parent().addClass('active');
        } else {
          $(this).parent().removeClass('active');
        }
      });

      // .ui.input input에 focus시 active 클래스 유지
      $('.branch-list-search .ui.input input').on('focus', function () {
        $(this).parent().addClass('active');
      });

      // .ui.input input에 blur시 active 클래스 제거
      $('.branch-list-search .ui.input input').on('blur', function () {
        const $parent = $(this).parent();

        // 비동기적으로 .btn-del을 클릭한 경우를 확인
        setTimeout(() => {
          // .btn-del을 클릭한 경우에는 active 클래스 유지
          if (!$parent.find('.btn-del').hasClass('clicked')) {
            $parent.removeClass('active');
          }
        }, 0);
      });
    </script>
  </body>
</html>
